<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teleworks ScreenPop</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <script>
        document.onreadystatechange = (event) => {
            if (document.readyState == "complete") {
                document.getElementById("close-icon").addEventListener("click", toggleSettings)
            }
        };

        function toggleSettings() {
            window.electron.send("toggle-settings");
        }

        window.electron.receive("settings-data", (auth, fieldsToDisplay) => {
            refresh(auth, fieldsToDisplay)
        });

        function refresh(auth, fieldsToDisplay){
            let authContainer = document.getElementById("settings-auth")
            authContainer.innerHTML = ""
            if(auth.redtail?.key && (auth.redtail.name || auth.redtail.id)) {
                let loggedIn = document.createElement("p")
                let uName = auth.redtail?.name || "<Missing Name>"
                let uId = auth.redtail?.id || "<Missing ID>"
                loggedin.innerHTML = "Logged in as: " + uName + " (" + uId + ")"

                let logoutButton = document.createElement("button")
                logoutButton.classList.add("bottom-button")
                logoutButton.onclick = hideApp
                logoutButton.innerHTML = "LOGOUT"

                authContainer.appendChild(loggedin)
                authContainer.appendChild(logoutButton)
            }

            let fields = document.getElementById("settings-fields")
            fields.innerHTML = ""
            fields.appendChild(makeField("Type", "redtail-type", fieldsToDisplay))
            fields.appendChild(makeField("Salutation", "redtail-salutation", fieldsToDisplay))
            fields.appendChild(makeField("Nickname", "redtail-nickname", fieldsToDisplay))
            fields.appendChild(makeField("Suffix", "redtail-suffix", fieldsToDisplay))
            fields.appendChild(makeField("Designation", "redtail-designation", fieldsToDisplay))
            fields.appendChild(makeField("DOB", "redtail-dob", fieldsToDisplay))
            fields.appendChild(makeField("Gender", "redtail-gender", fieldsToDisplay))
            fields.appendChild(makeField("Employer", "redtail-employer", fieldsToDisplay))
            fields.appendChild(makeField("Job Title", "redtail-job-title", fieldsToDisplay))
            fields.appendChild(makeField("Category", "redtail-category", fieldsToDisplay))
            fields.appendChild(makeField("Status", "redtail-status", fieldsToDisplay))
            fields.appendChild(makeField("Source", "redtail-source", fieldsToDisplay))
            fields.appendChild(makeField("Referred By", "redtail-referred-by", fieldsToDisplay))
            fields.appendChild(makeField("Tax ID", "redtail-tax-id", fieldsToDisplay))
            fields.appendChild(makeField("Marital Status", "redtail-marital-status", fieldsToDisplay))
            fields.appendChild(makeField("Marital Date", "redtail-marital-date", fieldsToDisplay))
            fields.appendChild(makeField("Client Since", "redtail-client-since", fieldsToDisplay))
            fields.appendChild(makeField("Servicing Advisor", "redtail-servicing-advisor", fieldsToDisplay))
            fields.appendChild(makeField("Writing Advisor", "redtail-writing-advisor", fieldsToDisplay))
            fields.appendChild(makeField("Email Addresses", "redtail-email-addresses", fieldsToDisplay))
            fields.appendChild(makeField("Street Addresses", "redtail-street-addresses", fieldsToDisplay))
            fields.appendChild(makeField("Phone Numbers", "redtail-phone-numbers", fieldsToDisplay))
        }

        function makeField(labelVal, inputVal, fieldsToDisplay){
            let isChecked = fieldsToDisplay.includes(inputVal)
            let field = document.createElement("div")
            field.classList.add("settings-field", isChecked ? "checked" : "unchecked")
            let checkbox = document.createElement("input")
            checkbox.type = "checkbox"
            checkbox.checked = isChecked
            checkbox.id = inputVal
            checkbox.name = inputVal
            checkbox.value = inputVal
            checkbox.addEventListener("change", (e) => {toggleField(e, inputVal, field)})
            let label = document.createElement("label")
            label.for = inputVal
            label.innerHTML = labelVal
            field.appendChild(checkbox)
            field.appendChild(label)
            return field
        }

        function toggleField(event, inputVal, field) {
            
        }

        
    </script>
    <header id="titlebar">
        <div id="drag-region">
            <div id="titlebar-left">
                <img id="app-icon" src="build/icon.png" alt="Teleworks"/>
                <span id="app-name">MINIP<span class="orange">O</span>P</span>
            </div>
            <div id="titlebar-center">
                <span id="window-name">SETTINGS</span>
            </div>
            <div id="titlebar-right-one">
                <div class="title-button">
                    <img  id="close-icon" src="build/close.svg" alt="Close to tray"/>
                </div>
            </div>
        </div>
    </header>
    <div id="settings-container">
        <div id="settings-left">
            <span id="crm-redtail" class="settings-crm-active"><span>Redtail</span></span>
        </div>
        <div id="settings-right">
            <div id="settings-logo-row">
                <img id="settings-logo-img" src="build/redtail-icon-full.png" alt="Redtail CRM" />
            </div>
            <div class="settings-banner">Authentication</div>
            <div id="settings-auth"></div>
            <div class="settings-banner">Display Fields</div>
            <div id="settings-fields" class="scroll-enabled">
            </div>
        </div>
    </div>
</body>
</html>